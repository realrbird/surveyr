% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/weight_creation.R
\name{svy_rake_with_trim}
\alias{svy_rake_with_trim}
\title{Iterative Raking and Trimming}
\usage{
svy_rake_with_trim(
  df,
  targets,
  base_weight = 1,
  max_iter = 10,
  lower_quantile = 0.01,
  upper_quantile = 0.99,
  min_weight = NULL,
  max_weight = NULL,
  print_output = TRUE
)
}
\arguments{
\item{df}{A data frame or tibble containing the survey variables.}

\item{targets}{A named list of tibbles containing the population targets (see \code{svy_rake}).}

\item{base_weight}{A character string for the column in \code{df} containing the
initial weights, or a numeric constant (e.g., \code{1}) for unweighted data.}

\item{max_iter}{The maximum number of rake-trim-rescale iterations to perform. Defaults to 10.}

\item{lower_quantile}{The lower quantile for trimming (passed to \code{svy_trim}). Defaults to 0.01.}

\item{upper_quantile}{The upper quantile for trimming (passed to \code{svy_trim}). Defaults to 0.99.}

\item{min_weight}{An optional absolute lower cap for weights (passed to \code{pewmethods::trim_weights} as \code{minval}).
If provided, overrides \code{lower_quantile}.}

\item{max_weight}{An optional absolute upper cap for weights (passed to \code{pewmethods::trim_weights} as \code{maxval}).
If provided, overrides \code{upper_quantile}.}

\item{print_output}{A logical flag. If \code{TRUE}, prints the final diagnostics.}
}
\value{
A \strong{numeric vector} containing the final iteratively raked and trimmed weights.
}
\description{
Performs an iterative process of raking (to population targets) and
trimming (to specific caps or quantiles) until the weights stabilize or the
maximum number of iterations is reached. This replicates the logic of common
SPSS raking macros.
}
\details{
The algorithm loop is:
\enumerate{
\item \strong{Rake} to targets (using \code{svy_rake}).
\item \strong{Trim} weights (using \code{svy_trim}).
\item \strong{Rescale} trimmed weights to match the sum of the weights from step 1.
\item Repeat until \code{max_iter} is reached or weights converge (not yet implemented).
}
}
\examples{
# Requires devtools::load_all()
if (requireNamespace("pewmethods", quietly = TRUE) & requireNamespace("dplyr", quietly = TRUE)) {
  data("survey_df")
  data("target_list")

  # Run iterative raking with strict caps (0.5 to 5.0)
  final_w <- svy_rake_with_trim(
    survey_df,
    target_list,
    base_weight = 1,
    min_weight = 0.2,
    max_weight = 5.0,
    max_iter = 5
  )
}

}
